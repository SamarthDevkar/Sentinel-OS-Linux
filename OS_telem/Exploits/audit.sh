#!/bin/bash

# Function to create a new user, change their password, grant superuser privileges, and delete the user
create_new_user() {
  local username="testUser"
  local password="hello"

  echo "Creating a new user: $username..."
  sudo useradd -m -s /bin/bash "$username"
  echo "Setting password for $username..."
  echo "$username:$password" | sudo chpasswd
  echo "Granting superuser privileges to $username..."
  sudo usermod -aG sudo "$username"
  echo "User $username created with superuser privileges and password '$password'."
}

# Function to create a text file in the user's home directory with modified permissions
create_text_file() {
  local username="testUser"
  local text_file="/home/$username/test.txt"

  echo "Creating a text file in the home directory for $username..."
  sudo -u "$username" touch "$text_file"
  echo "Applying chmod 600 to the text file..."
  sudo chmod 600 "$text_file"
  echo "Text file created: $text_file with permissions 600."
}

# Function to simulate unauthorized file access
simulate_unauthorized_file_access() {
  local username="testUser"
  local unauthorized_file="/home/$username/UnauthorizedFile.txt"

  echo "Simulating unauthorized file access..."
  # Create a file that the user does not have access to
  sudo -u "$username" touch "$unauthorized_file"
  echo "Attempting to access unauthorized file: $unauthorized_file..."
  sudo -u "$username" cat "$unauthorized_file"
  echo "Unauthorized file access attempted."
  # Clean up the unauthorized file
  sudo -u "$username" rm -f "$unauthorized_file"
  echo "Unauthorized file deleted."
}

# Function to delete a user
delete_user() {
  local username="testUser"
  echo "Deleting user: $username..."
  sudo userdel -r "$username"
  echo "User $username deleted."
}

# Function to delete a text file
delete_text_file() {
  local username="testUser"
  local text_file="/home/$username/test.txt"
  if [ -f "$text_file" ]; then
    echo "Deleting text file: $text_file..."
    sudo -u "$username" rm -f "$text_file"
    echo "Text file deleted: $text_file."
  else
    echo "Text file not found: $text_file"
  fi
}

# Run scenarios
echo "Running Scenarios"

# Create a new user, change their password, grant superuser privileges
while true;
do

	create_new_user

# Create a text file in the home directory with modified permissions
	create_text_file

# Simulate unauthorized file access
	simulate_unauthorized_file_access

# Delete the text file after all steps are executed
	delete_text_file

# Delete the user after all steps are executed
	delete_user

	echo "Scenarios completed."
	sleep 600
done

